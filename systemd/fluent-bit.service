[Unit]
Description=Fluent Bit Log Forwarder (Docker)
Requires=docker.service
After=docker.service

[Service]
Restart=always
RestartSec=5
ExecStartPre=/usr/bin/mkdir -p /opt/fluent-bit/state
ExecStart=/usr/bin/docker run --rm \
  --name fluent-bit \
  -v /opt/fluent-bit/fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf:ro \
  -v /opt/fluent-bit/parsers.conf:/fluent-bit/etc/parsers.conf:ro \
  -v /var/lib/docker/containers:/var/lib/docker/containers:ro \
  -v /var/lib/docker/volumes:/var/lib/docker/volumes:ro \
  -v /opt/fluent-bit/state:/var/lib/fluent-bit \
  fluent/fluent-bit:2.2
ExecStop=/usr/bin/docker stop -t 5 fluent-bit

[Install]
WantedBy=multi-user.target
